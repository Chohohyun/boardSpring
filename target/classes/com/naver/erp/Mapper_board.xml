<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--  namespace 속성값으로 DAO 인터페이스명이 오며 -->
<!-- DAO 인터페이스 메소드명과 동일한 id값을 소유한 태그를 내포하고 있다. -->
<mapper namespace="com.naver.erp.BoardDAO">
	<update id ="updatePrint_no" parameterType="com.naver.erp.BoardDTO">
		update board
		set print_no=print_no+1
		where group_no=(select group_no from board where b_no=${b_no})
			and print_no>(select print_no from board where b_no=${b_no})
	
	</update>
	<insert id="insertBoard" parameterType="com.naver.erp.BoardDTO">
		insert into board(
		b_no,
		subject,
		writer,
		content,
		pwd,
		email,
		group_no,
		print_no,
		print_level
		) values(
		(select nvl(max(b_no),0)+1 from board),
		#{subject},
		#{writer},
		#{content},
		#{pwd},
		#{email},
		
		
		<!-- mybatis 조건문을 이용하여 만약에 자바의 BoardDTO 객체의 -->
		<!-- 만약에 BoardDTO 객체의 속성변수 b_no 가 0이면 -->
		<!--  즉 새글쓰기 모드면 -->
		<!-- 그룹번호를 자기 PK를, 출력순서 번호 0, 들여쓰기 레벨0으로 입력하기 -->
		<!--  <주의> mybatis 조건문 형식 -->
		<!-- <if test="자바 문번과 유사한 조건식"> -->
		<!-- 		실행할 sql 구문 -->
		<!--  </if> -->
		<!-- 자바 문법과 유사한 조건식에서 or 또는 and가 사용가능하다 -->
		<!-- 자바 문법과 유사한 조건식에 투입되는 외부데이터는 -->
		<!-- 절대 #{} 또는 ${}로 감싸지 않고 그냥쓴다. -->
		<if test="b_no==0">
			(select nvl(max(b_no),0)+1 from board),
			0,
			0
		</if>
		
		
		<!-- 만약에 BoardDTO 객체의 속성변수 b_no 가 0이상이면 -->
		<!--  즉 댓글쓰기 모드면 -->
		<if test="b_no>0">
			(select group_no from board where b_no=${b_no}),
			(select print_no+1 from board where b_no=${b_no}),
			(select print_level+1 from board where b_no=${b_no})
		</if> 
		)
	</insert>
	<select id = "getBoardList" resultType="hashmap">
		select
			b_no||'' as "b_no",
			subject as "subject",
			writer as "writer",
			to_char(reg_date,'YYYY-MM-DD') "reg_date",
			readcount||'' as "readcount",
			content as "content",
			pwd as "pwd",
			email as "email",
			group_no||'' as "group_no",
			print_no||'' as "print_no",
			print_level||'' as "print_level"
		from board
		order by group_no desc,print_no asc
	</select>
	<select id = "getBoardListAllCnt" resultType="int">
		select 
			count(*)
		from board
	</select>
</mapper>
